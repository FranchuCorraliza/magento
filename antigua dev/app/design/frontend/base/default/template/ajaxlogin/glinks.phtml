<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php
/**
 * @see Mage_Page_Block_Template_Links
 */
?>
<script src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB).'js/ajaxlogin/jquery.fancybox.js'?>" type="text/javascript"></script>
<?php $_links = $this->getLinks(); ?>
<?php if(count($_links)>0): ?>
<ul class="links"<?php if($this->getName()): ?> id="<?php echo $this->getName() ?>"<?php endif;?>>
    <?php foreach($_links as $_link): ?>
        <?php if ($_link instanceof Mage_Core_Block_Abstract):?>
            <?php echo $_link->toHtml() ?>
        <?php else: ?>
          <?php if($_link->getTitle()!='Log In'){?>
          <li<?php if($_link->getIsFirst()||$_link->getIsLast()): ?> class="<?php if($_link->getIsFirst()): ?>first<?php endif; ?><?php if($_link->getIsLast()): ?> last<?php endif; ?>"<?php endif; ?> <?php echo $_link->getLiParams() ?>><?php echo $_link->getBeforeText() ?><a href="<?php echo $_link->getUrl() ?>" title="<?php echo $_link->getTitle() ?>" <?php echo $_link->getAParams() ?>><?php echo $_link->getLabel() ?></a><?php echo $_link->getAfterText() ?></li>
          <?php }else{?>
          <li><a href="#info-login-create" id="login-create" class="fancybox"  title="<?php echo $_link->getTitle() ?>" <?php echo $_link->getAParams() ?>><?php echo 'Login/Create Account';?></a></li>
          <?php }?>
        <?php endif;?>
    <?php endforeach; ?>
</ul>
<?php endif; ?>
<!-- DIV LOGIN_CREATE INFO  -->
<div id="info-login-create" style="display:none;min-width:700px;min-height:400px;">
	 <div class="page-title">
	        <h1><?php echo $this->__('Login or Create an Account') ?></h1>
	 </div>
	<?php echo $this->getMessagesBlock()->getGroupedHtml() ?>
    
	<div class="g-login" style="width:300px;float:left">
		<h2><?php echo $this->__('Registered Customers') ?></h2>
		<p><?php echo $this->__('If you have an account with us, please log in.') ?></p>
		<form action="#" method="post" id="g-form-login">
	                    <ul class="form-list">
	                        <li>
	                            <label for="email" class="required"><em>*</em><?php echo $this->__('Email Address') ?></label>
	                            <div class="input-box">
	                                <input type="text" name="login[username]" value="" id="gregistered-email" class="input-text required-entry validate-email" title="<?php echo $this->__('Email Address') ?>" />
	                            </div>
	                        </li>
	                        <li>
	                            <label for="pass" class="required"><em>*</em><?php echo $this->__('Password') ?></label>
	                            <div class="input-box">
	                                <input type="password" name="login[password]" class="input-text required-entry validate-password" id="gregistered-password" title="<?php echo $this->__('Password') ?>" />
	                            </div>
	                        </li>
	                        <?php //echo $this->getChildHtml('form.additional.info'); ?>
	                        <?php //echo $this->getChildHtml('persistent.remember.me'); ?>
	                    </ul>
	                    <?php //echo $this->getChildHtml('persistent.remember.me.tooltip'); ?>
	                    <p class="required"><?php echo $this->__('* Required Fields') ?></p>
	                
	                
	                <div class="buttons-set btn-new">
		               <div style="display:inline-block;width:170px;float:left">
		                  <label><?php echo $this->__('Forgot Your Password') ?></label><input style="margin-left:10px" type="checkbox"  id="gcheck-forgotpass"/>
		                </div>   
	                    <div id="footer-ajax-loader1"></div><button type="submit" class="button" title="<?php echo $this->__('Login') ?>" name="submit-login" id="submit-login"><span><span><?php echo $this->__('Login') ?></span></span></button>
	            	</div>
	       </form>
	       
	       <form action="<?php echo $this->getUrl('*/*/forgotpasswordpost') ?>" method="post" id="gform-forgot-password" style="display:none">
		    <div class="fieldset" style="padding-left:16px;margin-top:15px;">
		        <h2 class="legend"><?php echo $this->__('Retrieve your password here') ?></h2>
		        <p><?php echo $this->__('Please enter your email address below. You will receive a link to reset your password.') ?></p>
		        <ul class="form-list">
		            <li>
		                <label for="email_address" class="required"><em>*</em><?php echo $this->__('Email Address') ?></label>
		                <div class="input-box">
		                    <input type="text" name="email" alt="email" id="gforgot-emai-address" class="input-text required-entry validate-email" value="" />
		                </div>
		            </li>
		        </ul>
		    </div>
		    <div class="buttons-set btn-new">
		        <div id="footer-ajax-loader3"></div><button type="submit" title="<?php echo $this->__('Submit') ?>" class="button"><span><span><?php echo $this->__('Submit') ?></span></span></button>
		    </div>
		</form>
	</div>

	<div class="g-create" style="width:350px;float:right">
	  <h2><?php echo $this->__('New Customers') ?></h2>
	  		<div class="">
	            <form action="#" id="g-form-register-customer">
	               <ul class="form-list">
	               	<li>
	               		<label for="first-name" class="required"><em>*</em><?php echo $this->__('First Name') ?></label>
	               		<div class="input-box">
							<input id="firstname" class="input-text required-entry" type="text" title="First Name" value="" name="firstname" />
						</div>
	               	</li>
	               	<li>
	               	<label for="lastname" class="required"><em>*</em><?php echo $this->__('Last Name') ?></label>
	               		<div class="input-box">
							<input id="lastname" class="input-text required-entry" type="text" title="Last Name" value="" name="lastname" />
						</div>
	               	</li>
	               		
						
	               	<li>
	               		<label class="required"><em>*</em><?php echo $this->__('Email Address') ?></label>
	               		<div class="input-box">
							<input id="gcreate-email-address" class="input-text validate-email required-entry" type="text" title="Email Address" value="" name="email" />
						</div>
						
	               	</li>
	               	<li>
	               		<label  class="required"><em>*</em><?php echo $this->__('Password') ?></label>
	               		<div class="input-box">
							<input id="gcreate-password" class="input-text required-entry validate-password" type="password" title="Password" name="password"/>
						</div>
						
	               	</li>
	               	<li>
	               		<label class="required"><em>*</em><?php echo $this->__('Confirm Password') ?></label>
	               		<div class="input-box">
							<input id="confirmation" class="input-text required-entry validate-password" type="password" title="Password" name="confirmation"/>
						</div>
						
	               	</li>
	               	<li>
	               		<label><?php echo $this->__('Sign Up for Newsletter') ?></label>
	               		<span><input type="checkbox" name="is_subscribed" title="<?php echo $this->__('Sign Up for Newsletter') ?>" value="1" id="is_subscribed" /></span>
		                        
	               	</li>
	               
	               </ul>
					<div class="buttons-set btn-new">
	                    <div id="footer-ajax-loader2"></div><button type="submit" title="<?php echo $this->__('Create an Account') ?>" class="button" id="submit-create-account"><span><span><?php echo $this->__('Create an Account') ?></span></span></button>
	                </div>
				</form>
	        </div>
	</div>
        
    <script type="text/javascript">
    //<![CDATA[
        var dataForm = new VarienForm('g-form-login', true);
        var dataForm = new VarienForm('g-form-register-customer', true);
        var dataForm = new VarienForm('gform-forgot-password', true);
        
    //]]>
    </script>

</div>
<!-- END DIV LOGIN_CREATE INFO  -->
<script type="text/javascript">
jQuery(document).ready(function(){
	
	jQuery('.fancybox').fancybox();
	jQuery('#gregistered-email').val('');
	jQuery('#gcreate-password').val('');
	jQuery('#gcreate-email-address').val('');
	jQuery('#gregistered-password').val('');
	jQuery("#gcheck-forgotpass").change(function()
		{
		    if(this.checked){
		    	jQuery("#gform-forgot-password").show();
			}else{
				jQuery("#gform-forgot-password").hide();
			}
		});

	/* Login ajax */
        jQuery('#g-form-login').submit(function(event){
            event.preventDefault();
            if(!jQuery('#g-form-login div input').hasClass('validation-failed')){
                var data = jQuery('#g-form-login').serialize();
                jQuery('#footer-ajax-loader1').css('background', 'url(<?php echo $this->getSkinUrl('ajaxlogin/images/opc-ajax-loading-black.gif') ?>) no-repeat top right')
                jQuery.ajax({
                      url: "<?php echo $this->getUrl('ajaxlogin/account/guruthemeLogin') ?>",
                      type : 'post',
                      data: data,
                      success: function(data){
                          
                    	  //alert(JSON.stringify(data));
                    	  //alert(data);
                    	  var parsedJson = jQuery.parseJSON(data);                      
                          //alert(parsedJson.message);
                          if(parsedJson.message){
                        	  new Messi(parsedJson.message);
                          }
                          if(parsedJson.success){
                        	 new Messi('Login successfully');
                        	 //alert(parsedJson.success);
                        	 window.location = parsedJson.url;
                         }
                          jQuery('#footer-ajax-loader1').css('background', 'none');
                            //jQuery('#newsletter').val('');
                      }
                });
            }
        });

		/* Create account ajax */
        jQuery('#g-form-register-customer ').submit(function(event){
            event.preventDefault();
            if(!jQuery('#g-form-register-customer div input').hasClass('validation-failed')){
                var data = jQuery('#g-form-register-customer').serialize();
                jQuery('#footer-ajax-loader2').css('background', 'url(<?php echo $this->getSkinUrl('ajaxlogin/images/opc-ajax-loading-black.gif') ?>) no-repeat top right')
                jQuery.ajax({
                      url: "<?php echo $this->getUrl('ajaxlogin/account/guruthemeCreate') ?>",
                      type : 'post',
                      data: data,
                      success: function(data){
                    	  //alert(JSON.stringify(data));
                    	  var parsedJson = jQuery.parseJSON(data);                      
                          //alert(parsedJson.message);
                          if(parsedJson.message){
                        	  new Messi(parsedJson.message);
                          }
                          if(parsedJson.success){
                        	 window.location = parsedJson.url;
                        	 
                         }
                          jQuery('#footer-ajax-loader2').css('background', 'none');
                            //jQuery('#newsletter').val('');
                      }
                });
            }
        });


        /* Forgot Password */
        jQuery('#gform-forgot-password').submit(function(event){
            event.preventDefault();
            if(!jQuery('#gform-forgot-password div input').hasClass('validation-failed')){
                var data = jQuery('#gform-forgot-password').serialize();
                jQuery('#footer-ajax-loader3').css('background', 'url(<?php echo $this->getSkinUrl('ajaxlogin/images/opc-ajax-loading-black.gif') ?>) no-repeat top right')
                //alert(data);
                jQuery.ajax({
                      url: "<?php echo $this->getUrl('ajaxlogin/account/guruthemeForgotPass') ?>",
                      type : 'post',
                      data: data,
                      success: function(data){
                    	  var parsedJson = jQuery.parseJSON(data);                      
                          if(parsedJson.message){
                        	  new Messi(parsedJson.message);
                          }
                          /*if(parsedJson.success){
                        	 window.location = parsedJson.url;
                        	 
                         }*/
                         jQuery('#footer-ajax-loader3').css('background', 'none');
                            //jQuery('#newsletter').val('');
                      }
                });
            }
        });
        
});


</script>




